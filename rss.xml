<?xml version="1.0" encoding="utf-8"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Waxapple Code Segment</title><link>https://waxpple.github.io/</link><description>Risc V daliy base.</description><generator>Hugo 0.81.0 https://gohugo.io/</generator><language>en</language><managingEditor>a0910618112@gmail.com (Waxapple)</managingEditor><webMaster>a0910618112@gmail.com (Waxapple)</webMaster><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><lastBuildDate>Mon, 12 Jul 2021 02:47:43 +0000</lastBuildDate><atom:link rel="self" type="application/rss+xml" href="https://waxpple.github.io/rss.xml"/><item><title>[Day02] Basic terminology</title><link>https://waxpple.github.io/posts/day02/</link><guid isPermaLink="true">https://waxpple.github.io/posts/day02/</guid><pubDate>Mon, 12 Jul 2021 10:01:41 +0800</pubDate><author>a0910618112@gmail.com (Waxapple)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="domains">Domains&lt;/h1>
&lt;p>A &lt;em>domain&lt;/em> in its basic definition, is a grouping of logic cells. If consider a module as a blackbox. With its inputs and outputs, any given output is generated within one and only one domain.&lt;br>
&lt;code>Modules&lt;/code> come with two domain built in: a combinational domain and a sequential(synchronous) domain.&lt;/p>
&lt;h1 id="combinational">Combinational&lt;/h1>
&lt;p>Logic that contains no clocked elements is called combinational logic. This is one of the domain that a &lt;code>Module&lt;/code> contains. It is always named &lt;code>comb&lt;/code>, and it can be accessed via m.d.comb.&lt;br>
m means &lt;code>Module&lt;/code> and d means &lt;code>domain&lt;/code>.&lt;/p>
&lt;h1 id="synchronous">Synchronous&lt;/h1>
&lt;p>Logic that contains clocked elements is called synchronous (a.k.a sequential circuit) because all the FFs are triggered by particular clock domain. Each clock domain also has a reset signal which can reset all FFs to a given state. Finally, the domain specifies the edge of its clock on which all the FFs change: &lt;code>posedge&lt;/code> or &lt;code>negedge&lt;/code>.&lt;br>
Unless otherwise specified, there is one synchronous domain in a &lt;code>Module&lt;/code> called sync. It can be accessed via &lt;code>m.d.sync&lt;/code>.&lt;/p>
&lt;h1 id="creating-more-domains">Creating more domains&lt;/h1>
&lt;p>There is no reason to create combinational domains. As mentioned above, modules already contain one combinational domain, comb.&lt;br>
You can create a synchronous clock domain using &lt;code>ClockDomain(&amp;quot;&amp;lt;domain-name&amp;gt;&amp;quot;, clk_edge=&amp;quot;pos|neg&amp;quot;)&lt;/code>. This gives you both the clock and the reset signal for the domain. By default, the domain name is &lt;code>sync&lt;/code> and the clock edge is &lt;code>pos&lt;/code>.&lt;/p>
&lt;pre>&lt;code>m = Module()
mydomain = ClockDomain(&amp;quot;clk&amp;quot;)
m.domains += mydomain
m.d.mydomain += ... # logic to add in the &amp;quot;mydomain&amp;quot; clock domain.
&lt;/code>&lt;/pre>&lt;p>You can access a domain within a module by its name. So a domain created via ClockDomain(&amp;ldquo;my clock&amp;rdquo;) is accessed via &lt;code>m.d.myclock&lt;/code> or &lt;code>m.d[&amp;quot;myclk&amp;quot;]&lt;/code>. \&lt;/p>
&lt;ul>
&lt;li>&lt;code>ClockSignal(domain=&amp;quot;&amp;lt;domain&amp;gt;&amp;quot;)&lt;/code> gives you the clock signal for the given domain.&lt;/li>
&lt;li>&lt;code>ResetSignal(domain=&amp;quot;&amp;lt;domain&amp;gt;&amp;quot;)&lt;/code> gives you the reset signal for the given domain.&lt;/li>
&lt;/ul>
&lt;h1 id="tips-clock-domains-with-the-same-clock-but-different-edges">Tips: Clock domains with the same clock but different edges.&lt;/h1>
&lt;p>This can be done simply by creating one &lt;code>clockdomain&lt;/code>&lt;/p>
&lt;pre>&lt;code>pos = ClockDomain(&amp;quot;pos&amp;quot;)
neg = ClockDomain(&amp;quot;neg&amp;quot;, clk_edge=&amp;quot;neg&amp;quot;)
&lt;/code>&lt;/pre>&lt;p>Next, assign them with same clock driven&lt;/p>
&lt;pre>&lt;code>neg.clk = pos.clk
neg.rst = pos.rst
&lt;/code>&lt;/pre>&lt;p>And then you can add these to the module. We can add more than domain to a module with the same statement.&lt;/p>
&lt;pre>&lt;code>m.domains += [pos, neg]
&lt;/code>&lt;/pre>&lt;h1 id="access-to-domains">Access to domains&lt;/h1>
&lt;p>A module can access its domains via its &lt;code>d&lt;/code> attribute. By default, if a synchronous domain is added to a module&amp;rsquo;s &lt;code>domain&lt;/code>, then all modules everywhere will also have access to that domain via their d attribute, even if that module is not a submodule of the module where the domain was added.&lt;/p>
&lt;pre>&lt;code>m = Module()
m2 = Module()
m.domains += ClockDomain(&amp;quot;thing&amp;quot;)
m.d.thing += # logic
# This is implicity
m2.d.thing += #logic
&lt;/code>&lt;/pre>&lt;p>If you want to explicitly inhibit this global propagation by setting the &lt;code>local&lt;/code> named parameter of the &lt;code>ClockDomain&lt;/code> to &lt;code>True&lt;/code>.&lt;/p>
&lt;pre>&lt;code>m = Module()
m2 = Module()
m.domains += ClockDomain(&amp;quot;thing&amp;quot;, local=True)
m.d.thing += # logic
# Error will occur here.
m2.d.thing += # logic
&lt;/code>&lt;/pre></description></item><item><title>[Day01] Basic nMigen</title><link>https://waxpple.github.io/posts/day01/</link><guid isPermaLink="true">https://waxpple.github.io/posts/day01/</guid><pubDate>Sat, 10 Jul 2021 10:50:02 +0800</pubDate><author>a0910618112@gmail.com (Waxapple)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="basic-structure-of-modules">Basic structure of modules&lt;/h1>
&lt;p>The tutorial is followed by &lt;a href="https://github.com/RobertBaruch/nmigen-tutorial/">https://github.com/RobertBaruch/nmigen-tutorial/&lt;/a>
Thumbs up for his contributions.&lt;/p>
&lt;pre>&lt;code>from nmigen import *
from nmigen.build import Platform
class ThingBlock(Elaboratable):
def __init__(self):
pass
def elaborate(self, platform: Platform) -&amp;gt; Module:
m = Module()
return m
&lt;/code>&lt;/pre>&lt;h1 id="elaborating-a-module">Elaborating a module&lt;/h1>
&lt;pre>&lt;code>from nmigen.cli import main
if __name__== &amp;quot;__main__&amp;quot;:
sync = ClockDomain()
block = ThingBlock()
m = Module()
m.domains += sync
m.submodules += block
main(m, ports=[sync.clk,sync.rst])
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>main(module, ports=[&lt;ports>], platform=&amp;quot;&lt;platform>&amp;quot;) translate the given module into verilog. This is call &lt;em>elaboration&lt;/em>. All elaborate() medthod will have its platform argument set to the given platform like particular chips or evaluation boards.&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>python3 thing.py generate -t [v|il] &amp;gt; thing.[v|il]
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>If you encounter any error message, Back to day00 and install the pre-requisties.&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>Choose RTLIL if using yosys.&lt;/li>
&lt;/ul></description></item><item><title>[Day00] nMigen 戰鬥</title><link>https://waxpple.github.io/posts/day00/</link><guid isPermaLink="true">https://waxpple.github.io/posts/day00/</guid><pubDate>Fri, 09 Jul 2021 14:33:00 +0800</pubDate><author>a0910618112@gmail.com (Waxapple)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="第一天接觸nmigen-先來安裝nmigen">第一天接觸nMigen, 先來安裝　nMigen!&lt;/h1>
&lt;p>&lt;img src="https://m-labs.hk/images/migen@2x.png?h=43d4e86170d805ce58f90901ae31a64141ea32606f7cefcb4b2b165e362c2b9a" alt="1">&lt;/p>
&lt;h1 id="安裝prerequisites">安裝Prerequisites&lt;/h1>
&lt;pre>&lt;code>sudo apt-get install build-essential clang bison flex libreadline-dev \
gawk tcl-dev libffi-dev git mercurial graphviz \
xdot pkg-config python python3 libftdi-dev gperf \
libboost-program-options-dev autoconf libgmp-dev \
cmake
&lt;/code>&lt;/pre>&lt;h1 id="安裝有的沒的必備程式">安裝有的沒的必備程式&lt;/h1>
&lt;p>參考 &lt;a href="https://symbiyosys.readthedocs.io/en/latest/install.html">https://symbiyosys.readthedocs.io/en/latest/install.html&lt;/a>&lt;/p>
&lt;h1 id="安裝nmigen">安裝nMigen&lt;/h1>
&lt;pre>&lt;code>pip install git+https://github.com/m-labs/nmigen.git
pip install git+https://github.com/m-labs/nmigen-boards.git
&lt;/code>&lt;/pre>&lt;p>安裝之後就可以開始學習如何使用nMigen製作電路&lt;/p>
&lt;h1 id="value-in-migen">Value in migen&lt;/h1>
&lt;h2 id="const-永不變">Const 永不變&lt;/h2>
&lt;pre>&lt;code>from nmigen import *
a = Const(10)
a.shape()
&amp;gt;&amp;gt; Shape(width=4, signed=False)
a = Const(10)
a.shape()
&amp;gt;&amp;gt; Shape(width=5, signed=True)
x = Const(3,range(-5,11))
x.shape()
&amp;gt;&amp;gt; Shape(width=5, signed=True)
&lt;/code>&lt;/pre>&lt;h2 id="可以使用enum-來做常數狀態">可以使用Enum 來做常數狀態&lt;/h2>
&lt;pre>&lt;code>from enum import Enum, unique
@unique
class Func(Enum):
NONE = 0
ADD = 1
SUB = 2
MUL = 3
DIV = 4
...
&amp;gt;&amp;gt;&amp;gt; x = Const(2, Func)
&amp;gt;&amp;gt;&amp;gt; x.shape()
unsigned(3)
&amp;gt;&amp;gt;&amp;gt; x = Value.cast(Func.NONE)
&amp;gt;&amp;gt;&amp;gt; x
const 3'd0
&lt;/code>&lt;/pre>&lt;h2 id="signal-是-wire或者reg">Signal 是 Wire或者reg&lt;/h2>
&lt;pre>&lt;code>&amp;gt;&amp;gt;&amp;gt; from nmigen import *
&amp;gt;&amp;gt;&amp;gt; A = Signal(signed(8))
&amp;gt;&amp;gt;&amp;gt; A.shape()
Shape(width=8, signed=True)
&lt;/code>&lt;/pre>&lt;pre>&lt;code>&amp;gt;&amp;gt;&amp;gt; x = Signal(range(-5,11))
&amp;gt;&amp;gt;&amp;gt; x.shape()
Shape(width=5, signed=True)
&lt;/code>&lt;/pre>&lt;pre>&lt;code>&amp;gt;&amp;gt;&amp;gt; x = Signal(Func)
&amp;gt;&amp;gt;&amp;gt; x
(sig x)
&amp;gt;&amp;gt;&amp;gt; x = Signal(unsigned(16),name=&amp;quot;dout&amp;quot;)
&amp;gt;&amp;gt;&amp;gt; x.name
'dout'
&lt;/code>&lt;/pre>&lt;hr>
&lt;blockquote>
&lt;p>但是我安裝Miniconda 後整個WSL的ssl都掛了，建議不要安裝&lt;/p>
&lt;h1 id="安裝miniconda">安裝Miniconda&lt;/h1>
&lt;p>因為我是用WSL，也沒有GUI，就直接用miniconda就好了。&lt;/p>
&lt;pre>&lt;code>wget https://repo.anaconda.com/miniconda/Miniconda3-py39_4.9.2-Linux-x86_64.sh
chmod +x Miniconda3-py39_4.9.2-Linux-x86_64.sh
./Miniconda3-py39_4.9.2-Linux-x86_64.sh
&lt;/code>&lt;/pre>&lt;/blockquote></description></item></channel></rss>